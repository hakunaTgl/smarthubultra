<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Hub Ultra - Sign In</title>
  <link rel="stylesheet" href="./css/style.css">
  <link rel="manifest" href="./manifest.json">
  <!-- Firebase is initialized from modules inside /js/main.js so bundlers resolve the 'firebase' package from node_modules -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div style="display:flex;gap:8px;align-items:center;padding:12px;">
      <button id="dark-mode-toggle" aria-pressed="false">ðŸŒ™ Dark</button>
      <button id="voice-toggle" aria-pressed="false">ðŸŽ¤ Voice</button>
      <span id="voice-status" style="margin-left:8px;font-size:0.9rem;color:var(--muted)"></span>
    </div>
  </header>
  <div id="auth-page" class="page">
    <div class="page-content glassmorphic">
      <h2>Smart Hub Ultra</h2>
      <div id="vibe-quiz-container"></div>
      <form id="sign-up-form">
        <input type="email" id="sign-up-email" placeholder="Email" required>
        <input type="text" id="sign-up-username" placeholder="Username (optional)">
        <label style="font-size:0.85rem;color:var(--muted)">We'll send a secure sign-in link to your email. No passwords required.</label>
        <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
          <button id="send-signin-link" type="button">Send Sign-in Link</button>
          <button type="submit">Send & Create Account</button>
        </div>
      </form>
      <form id="sign-in-form">
        <input type="email" id="sign-in-email" placeholder="Email" required>
        <button type="submit">Sign In (email link)</button>
        <a href="#" id="forgot-password">Resend sign-in link</a>
      </form>

      <div id="magic-link-fallback" class="auth-fallback hidden">
        <p class="auth-fallback__title">Instant magic link</p>
        <p id="magic-link-meta" class="auth-fallback__meta"></p>
        <div class="auth-fallback__field">
          <input id="magic-link-url" type="text" readonly>
          <button id="magic-link-copy" type="button">Copy</button>
        </div>
      </div>
      
      <div style="margin: 20px 0; text-align: center; color: var(--muted);">
        â€” OR â€”
      </div>

      <div class="auth-quick-actions">
        <button id="guest-login-btn" type="button">Continue as Guest</button>
        <button id="admin-fast-login-btn" type="button">Executive Fast Login</button>
      </div>
      
      <form id="instance-code-form">
        <h3>Join with Instance Code</h3>
        <input type="email" id="code-email" placeholder="Your Email" required>
        <input type="text" id="instance-code" placeholder="Instance Code (8 digits)" required maxlength="8" pattern="[0-9]{8}">
        <button type="submit">Join Session</button>
        <label style="font-size:0.85rem;color:var(--muted);">
          Enter an 8-digit instance code to join a shared chat/workspace session.
        </label>
      </form>

      <section class="auth-invite">
        <h3>Invite a collaborator</h3>
        <form id="invite-collab-form">
          <input type="email" id="invite-email" placeholder="Their email" required>
          <select id="invite-role">
            <option value="user" selected>Standard user</option>
            <option value="guest">Guest</option>
            <option value="admin">Admin (executive)</option>
          </select>
          <button type="submit">Generate invite link</button>
        </form>
        <div id="invite-link-output" class="auth-fallback hidden">
          <p class="auth-fallback__title">Share this invite link</p>
          <p id="invite-link-meta" class="auth-fallback__meta"></p>
          <div class="auth-fallback__field">
            <input id="invite-link-url" type="text" readonly>
            <button id="invite-link-copy" type="button">Copy</button>
          </div>
        </div>
      </section>
      <form id="support-form">
        <input type="email" id="support-email" placeholder="Email" required>
        <textarea id="support-message" placeholder="Describe your issue" required></textarea>
        <button type="submit">Submit Support Ticket</button>
      </form>
    </div>
  </div>
  <!-- Firebase compatibility shim (creates window.firebase for legacy modules) -->
  <script type="module" src="./js/firebase-compat.js"></script>
  <script src="./js/main.js" type="module"></script>
  <script type="module">
    import { mountVibeQuiz } from './js/vibeQuiz.js';
    import { loadAuth } from './js/auth.js';
    
    // Initialize components when DOM is ready
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        mountVibeQuiz('vibe-quiz-container');
        await loadAuth();
      } catch (error) {
        console.error('Component initialization error:', error);
      }
    });
  </script>
</body>
</html>
